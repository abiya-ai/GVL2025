# cloudbuild.yaml
options:
  logging: CLOUD_LOGGING_ONLY
steps:
# 1. Build the Docker Image (If using Cloud Run/GKE)
- name: 'gcr.io/cloud-builders/docker'
  id: Build
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/vibecoding:$SHORT_SHA', '.']

# 2. Push the Docker Image
- name: 'gcr.io/cloud-builders/docker'
  id: Push
  args: ['push', 'gcr.io/$PROJECT_ID/vibecoding:$SHORT_SHA']

# 3. Deploy the new version to Cloud Run
- name: 'gcr.io/cloud-builders/gcloud'
  id: Deploy
  args:
  - 'run'
  - 'deploy'
  - 'gvl-webapp' 
  - '--image=gcr.io/$PROJECT_ID/gvl2025-workshop:$SHORT_SHA'
  - '--region=us-central1' 
  - '--no-allow-unauthenticated' 